{% extends 'shared/base.html' %}
{% load static %}

{% block title %}{{ og_data.title }} - Echo Sphere{% endblock %}
{% block description %}{{ og_data.description }}{% endblock %}
{% block author %}{{ post.author.first_name }} {{ post.author.last_name }}{% endblock %}

{% block og_title %}{{ og_data.title }}{% endblock %}
{% block og_description %}{{ og_data.description }}{% endblock %}
{% block og_type %}{{ og_data.type }}{% endblock %}
{% block og_url %}{{ og_data.url }}{% endblock %}
{% block og_image %}{% if og_data.image %}
<meta property="og:image" content="{{ og_data.image }}" />{% endif %}{% endblock %}

{% block twitter_title %}{{ og_data.title }}{% endblock %}
{% block twitter_description %}{{ og_data.description }}{% endblock %}
{% block twitter_image %}{% if og_data.image %}
<meta name="twitter:image" content="{{ og_data.image }}" />{% endif %}{% endblock %}

{% block extra_css %}
<style>
  /* Post detail specific styles */
  .post-detail {
    max-width: 600px;
    margin: 0 auto;
    padding: 20px;
    background-color: hsl(var(--background));
    min-height: calc(100vh - 3.5rem);
    transition: background-color 0.2s ease;
  }

  .post-header {
    margin-bottom: 20px;
  }

  .post-title {
    font-size: 28px;
    font-weight: 700;
    margin-bottom: 12px;
    color: hsl(var(--foreground));
    line-height: 1.3;
  }

  .post-meta {
    color: hsl(var(--muted-foreground));
    font-size: 14px;
    margin-bottom: 15px;
  }

  .post-body {
    line-height: 1.7;
    margin-bottom: 24px;
    color: hsl(var(--foreground));
    font-size: 16px;
  }

  .post-body a {
    color: hsl(var(--primary));
    text-decoration: none;
  }

  .post-body a:hover {
    color: hsl(var(--accent));
    text-decoration: underline;
  }

  .post-body strong {
    color: hsl(var(--foreground));
    font-weight: 600;
  }

  .post-body em {
    color: hsl(var(--muted-foreground));
    font-style: italic;
  }

  .post-media {
    margin: 24px 0;
    background-color: hsl(var(--muted));
    border: 1px solid hsl(var(--border));
    border-radius: calc(var(--radius) - 2px);
    padding: 16px;
    transition: background-color 0.2s ease, border-color 0.2s ease;
  }

  .post-media img {
    max-width: 100%;
    height: auto;
    border-radius: calc(var(--radius) - 4px);
    box-shadow: 0 4px 12px hsl(var(--foreground) / 0.1);
  }

  .post-media video {
    max-width: 100%;
    height: auto;
    border-radius: calc(var(--radius) - 4px);
    box-shadow: 0 4px 12px hsl(var(--foreground) / 0.1);
  }

  .post-media audio {
    width: 100%;
    border-radius: calc(var(--radius) - 4px);
  }

  .author-info {
    display: flex;
    align-items: center;
    margin-bottom: 16px;
    gap: 8px;
  }

  .author-name {
    font-weight: 600;
    color: hsl(var(--foreground));
    font-size: 16px;
  }

  .post-date {
    color: hsl(var(--muted-foreground));
    font-size: 14px;
  }

  /* Theme debug info (only in development) */
  .theme-debug {
    position: fixed;
    top: 10px;
    right: 10px;
    background: hsl(var(--muted));
    border: 1px solid hsl(var(--border));
    padding: 8px;
    border-radius: 4px;
    font-size: 12px;
    z-index: 1000;
    display: none;
  }

  .theme-debug button {
    margin-right: 4px;
    padding: 2px 6px;
    font-size: 10px;
  }

  /* Responsive design */
  @media (max-width: 640px) {
    .post-detail {
      padding: 16px;
    }

    .post-title {
      font-size: 24px;
    }

    .post-media {
      padding: 12px;
    }
  }
</style>
{% endblock %}

{% block content %}
<!-- Theme debug info (only in development) -->
{% if debug %}
<div id="theme-debug" class="theme-debug">
  <div>Theme: <span id="current-theme">-</span></div>
  <div>Saved: <span id="saved-preference">-</span></div>
  <div>System: <span id="system-preference">-</span></div>
  <div style="margin-top: 4px;">
    <button onclick="toggleTheme()">Toggle</button>
    <button onclick="clearThemePreference()">Clear</button>
  </div>
</div>
{% endif %}

<!-- Server-rendered post content for SEO and social sharing -->
<div class="post-detail">
  <div class="post-header">
    <div class="author-info">
      <span class="author-name">{{ post.author.first_name }} {{ post.author.last_name }}</span>
      <span class="post-date">@{{ post.author.username }} â€¢ {{ post.created|date:"M d, Y" }}</span>
    </div>
  </div>

  {% if post.head %}
  <h1 class="post-title">{{ post.head }}</h1>
  {% endif %}

  {% if post.body %}
  <div class="post-body">{{ post.body|linebreaks }}</div>
  {% endif %}

  {% if post.media %}
  <div class="post-media">
    {% if post.media.media_type == 'image' %}
    {% if post.media.thumbnail %}
    <img src="{{ post.media.thumbnail.url }}" alt="{{ post.media.alt_text|default:post.head }}" />
    {% elif post.media.file %}
    <img src="{{ post.media.file.url }}" alt="{{ post.media.alt_text|default:post.head }}" />
    {% endif %}
    {% elif post.media.media_type == 'video' %}
    <video controls>
      <source src="{{ post.media.file.url }}" type="video/mp4">
      Your browser does not support the video tag.
    </video>
    {% elif post.media.media_type == 'audio' %}
    <audio controls>
      <source
        src="{% if post.media.mp3_file %}{{ post.media.mp3_file.url }}{% else %}{{ post.media.file.url }}{% endif %}"
        type="audio/mpeg">
      Your browser does not support the audio tag.
    </audio>
    {% endif %}
  </div>
  {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
  // Show debug panel in development
  {% if debug %}
  document.addEventListener("DOMContentLoaded", function () {
    const debugPanel = document.getElementById("theme-debug");
    if (debugPanel) {
      debugPanel.style.display = "block";
      updateDebugPanel();
    }
  });

  // Update debug panel
  function updateDebugPanel() {
    const debugPanel = document.getElementById("theme-debug");
    if (debugPanel) {
      const info = window.getThemeInfo();
      document.getElementById("current-theme").textContent = info.currentTheme;
      document.getElementById("saved-preference").textContent = info.savedPreference || "none";
      document.getElementById("system-preference").textContent = info.systemPrefersDark ? "dark" : "light";
    }
  }

  // Add getThemeInfo function if not already defined
  if (typeof window.getThemeInfo === 'undefined') {
    window.getThemeInfo = function () {
      return {
        currentTheme: document.documentElement.classList.contains("dark") ? "dark" : "light",
        savedPreference: localStorage.getItem("app-theme"),
        systemPrefersDark: window.matchMedia("(prefers-color-scheme: dark)").matches,
        systemPrefersLight: window.matchMedia("(prefers-color-scheme: light)").matches
      };
    };
  }
  {% endif %}
</script>
{% endblock %}
